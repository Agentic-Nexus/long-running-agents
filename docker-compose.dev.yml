# 大模型驱动的股票分析系统 - Docker Compose 开发环境
# 使用方式: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  # ===================
  # 开发环境后端
  # ===================
  backend:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder  # 使用构建阶段以支持热重载
    container_name: stock_analyzer_backend_dev
    environment:
      - ENV=development
      - DEBUG=true
    volumes:
      - .:/app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  # ===================
  # 开发环境前端
  # ===================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: builder
    container_name: stock_analyzer_frontend_dev
    environment:
      - NODE_ENV=development
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    ports:
      - "${VITE_DEV_PORT:-5173}:5173"
    # 开发模式使用 Vite 开发服务器
    command: npm run dev -- --host 0.0.0.0
    depends_on:
      - backend
